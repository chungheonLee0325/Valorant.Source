# 확장 가능한 스킬 대량 구현

## 1. 문제 정의: 12개의 고유 스킬을 어떻게 효율적으로 생산할 것인가?

이 프로젝트는 4명의 요원이 각각 3개의 고유한 스킬(C, Q, E)을 가지며, 이는 총 12개의 스킬을 구현해야 함을 의미합니다. 각 스킬은 저마다 다른 애니메이션, 이펙트, 투사체, 그리고 고유한 동작 방식을 가집니다. 이러한 다양성을 수용하면서도 코드의 중복을 최소화하고, 앞으로 추가될 새로운 요원과 스킬에 대비할 수 있는 확장 가능한 구조를 만드는 것이 이 시스템의 핵심적인 도전 과제였습니다.

## 2. 공용화 전략: 적은 코드로 많은 스킬 구현하기

이 문제를 해결하기 위해, `UBaseGameplayAbility`를 중심으로 한 강력한 공용화 전략을 수립했습니다. 파생 스킬 클래스는 최소한의 코드만 오버라이드하고, 대부분의 복잡한 로직은 부모 클래스의 프레임워크에 위임합니다.

*   **ActivationType 패턴화**: 스킬을 즉시 발동하는 `Instant` 타입과, 준비 단계를 거치는 `WithPrepare` 타입으로 분리했습니다. 두 타입은 시작 방식만 다를 뿐, 나머지 상태 전이, 네트워크 복제, 정리 과정은 모두 동일한 수명 주기를 따릅니다.
*   **FollowUp 입력 통일**: `WithPrepare` 타입의 스킬이 `Waiting` 상태일 때, 마우스 좌/우클릭 입력은 `GameplayEvent`를 통해 어빌리티로 안정적으로 라우팅됩니다. 개발자는 `OnLeftClickInput()`, `OnRightClickInput()` 함수만 구현하면, 복잡한 입력 처리 없이 후속 동작을 정의할 수 있습니다.
*   **1P/3P 프리뷰 분리**: 스킬 준비 시 손에 보이는 장착물(Equipped Preview)은 1인칭은 로컬에서만 생성(비복제)하고, 3인칭은 서버에서 생성하여 복제하는 방식으로 분리했습니다. 이를 통해 불필요한 네트워크 트래픽을 줄이고, 다른 플레이어에게는 안정적으로 보이는 반면 자신에게는 즉각적으로 표시되어 지연이나 깜빡임 없는 UX를 제공합니다.
*   **투사체/지상 효과 모듈화**: 스킬이 발사할 투사체나 설치할 장판 액터는 `ProjectileClass` 변수에 지정한 후, `SpawnProjectile()` 유틸리티 함수를 호출하는 것만으로 스폰, 소유권 설정, 네트워크 복제, 발사 이펙트 재생까지 한 번에 처리됩니다.
*   **데이터 기반 파라미터**: 스킬의 ID, 비용, 스택(충전 횟수) 등은 모두 데이터 테이블에서 관리됩니다. 이를 통해 C++ 코드 변경 없이 밸런스를 쉽게 조절할 수 있으며, 상점 및 경제 시스템과 자연스럽게 연동됩니다.

### 공통 패턴 예시: 준비 후 투척형 어빌리티

모든 `WithPrepare` 타입 스킬이 동일한 구조를 따르는 것은 아니지만, \'스킬 키를 눌러 장착물을 손에 들고(Prepare), 마우스 클릭으로 던지는(Execute)\' 유형의 스킬들에서는 아래와 같은 공통적인 패턴이 발견됩니다. 이는 `UBaseGameplayAbility`의 상속 구조가 어떻게 코드 재사용을 촉진하는지 보여주는 좋은 예시입니다.

```cpp
// 준비 후 투척형 어빌리티의 일반적인 구조
class UMy_ThrowableAbility : public UBaseGameplayAbility {
 public:
  UMy_ThrowableAbility(){
    ActivationType = EAbilityActivationType::WithPrepare;
    FollowUpInputType = EFollowUpInputType::LeftOrRight; // 좌/우클릭으로 다른 투사체/방식 선택
  }
  // 스킬 준비 시, 손에 장착할 프리뷰 액터(1P/3P)를 스폰합니다.
  void PrepareAbility() override { SpawnEquippedPreview(); }
  // 프리뷰 액터의 장착 애니메이션을 재생합니다.
  void WaitAbility() override { if (Preview3P) Preview3P->OnEquip(); }
  // 좌클릭 입력 시, 프리뷰를 제거하고 실제 투사체를 발사합니다.
  bool OnLeftClickInput() override { DestroyPreview(); ProjectileClass=LeftClickProjectile; return SpawnProjectile(); }
  // 우클릭 입력 시, 프리뷰를 제거하고 다른 투사체를 발사합니다.
  bool OnRightClickInput() override { DestroyPreview(); ProjectileClass=RightClickProjectile; return SpawnProjectile(); }
  // 어빌리티가 어떤 이유로든 종료될 때, 프리뷰 액터가 남아있다면 안전하게 제거합니다.
  void EndAbility(...) override { DestroyPreview(); Super::EndAbility(...); }
};
```

## 3. 요원별 스킬 구현 현황

아래 표는 현재 구현된 12개 스킬이 위 아키텍처를 통해 어떻게 효율적으로 구현되었는지 보여줍니다.

### Jett

| 슬롯 | 스킬 | ActivationType | FollowUp | 핵심 동작                   | 핵심 파일 |
|---|---|---|---|-------------------------|---|
| C | Cloudburst | Instant | None | 연막 투사체 스폰<br>Hit시 연막 생성 | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Jett/Jett_C_Cloudburst.cpp#L15) |
| Q | Updraft | Instant | None | 수직 점프 부스트, 중력/브레이킹 조정   | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Jett/Jett_Q_Updraft.cpp#L25) |
| E | Tailwind | Instant | None | 전방 대시, 마찰/브레이킹 조정       | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Jett/Jett_E_Tailwind.cpp#L48) |

### Phoenix

| 슬롯 | 스킬 | ActivationType | FollowUp | 핵심 동작                                                                  | 핵심 파일 |
|---|---|---|---|------------------------------------------------------------------------|---|
| C | Blaze | WithPrepare | Left/Right | 직선/곡선 Spline Wall 생성<br>가까이 접근시 시야 차단 효과<br>적군 : DotDamage / 본인 : Heal | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Phoenix/Phoenix_C_Blaze.cpp#L22) |
| Q | Hot Hands | WithPrepare | Left/Right | 화염 오브 투사체 직선/포물선 투척<br>Hit시 화염 지대 생성<br>적군 : DotDamage / 본인 : Heal     | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Phoenix/Phoenix_Q_HotHands.cpp#L41) |
| E | Curveball | WithPrepare | Left/Right | 섬광탄 투사체 좌/우 커브 투척 <br> Flash 시스템 연동                                    | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Phoenix/Phoenix_E_Curveball.cpp#L24) |

### Sage

| 슬롯 | 스킬 | ActivationType | FollowUp | 핵심 동작                                            | 핵심 파일 |
|---|---|---|---|--------------------------------------------------|---|
| C | Barrier Orb | WithPrepare | Left/Right | 벽 프리뷰 생성<br>회전(RB)→설치(LB) 벽 생성 확정<br>총으로 벽 파괴 가능 | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Sage/Sage_C_BarrierOrb.cpp#L61) |
| Q | Slow Orb | WithPrepare | Left | 슬로우 오브 투사체 투척<br> Hit시 슬로우 지대 생성                 | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Sage/Sage_Q_SlowOrb.cpp#L51) |
| E | Healing Orb | WithPrepare | Left/Right | 아군 힐(LB)/자가 힐(RB) 선택 사용                          | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/Sage/Sage_E_HealingOrb.cpp#L71) |

### KAY/O

| 슬롯 | 스킬 | ActivationType | FollowUp | 핵심 동작                                                     | 핵심 파일 |
|---|---|---|---|-----------------------------------------------------------|---|
| C | FRAG/ment | WithPrepare | Left/Right | 오버핸드<LB>/언더핸드<RB> 수류탄 투척<br>시간 지연후 3차례 폭파<br>거리감쇠 데미지     | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/KAYO/KAYO_C_FRAGMENT.cpp#L53) |
| Q | FLASH/drive | WithPrepare | Left/Right | 직선/포물선 플래시 투사체 투척<br> Flash 시스템 연동                        | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/KAYO/KAYO_Q_FLASHDRIVE.cpp#L73) |
| E | ZERO/point | WithPrepare | Left | 제압 나이프 투사체 투척 <br> 일정 시간후 폭발 <br> 적중한 적에게 '제압' 상태이상을 부여 | [Code](https://github.com/chungheonLee0325/VALORANT/blob/main/UnrealEngine/Valorant/Source/Valorant/AbilitySystem/Abilities/KAYO/KAYO_E_ZEROPOINT.cpp#L53) |
    - 제압(`State.Debuff.Suppressed`)은 모든 신규 스킬 사용을 차단하고 시전중인 스킬을 강제 취소시키는 상태이상

## 4. 신규 스킬 추가 가이드

새로운 스킬을 추가하는 개발자는 아래의 절차를 따릅니다.

1.  **파일 생성**: `Source/Valorant/AbilitySystem/Abilities/<Agent>/<AbilityName>.*` 경로에 `UBaseGameplayAbility`를 상속받는 새 C++ 클래스를 생성합니다.
2.  **타입 결정**: 생성자에서 스킬의 동작 방식에 맞게 `ActivationType`과 `FollowUpInputType`을 설정합니다.
3.  **로직 구현**: `PrepareAbility`, `WaitAbility`, `ExecuteAbility`, `OnLeftClickInput`, `OnRightClickInput` 등 필요한 함수를 오버라이드하여 스킬의 고유 로직을 구현합니다. 대부분의 경우, `SpawnProjectile()`과 같은 부모 클래스의 유틸리티 함수를 호출하는 것으로 충분합니다.
4.  **데이터 연결**: 블루프린트 에셋을 생성하고, 부모 클래스에 정의된 변수들(애니메이션 몽타주, 사운드, 파티클, 투사체 클래스 등)을 채워 넣습니다.
5.  **데이터 테이블 등록**: 새로운 스킬의 ID, 비용, 스택 등의 정보를 데이터 테이블에 추가합니다.

## 5. 관련 시스템 (Related Systems)

*   **[GAS 아키텍처](./1.2_Project-GAS-Architecture.md)**: 이 문서에서 설명하는 생산 방식의 기반이 되는 전체적인 시스템 구조입니다.
*   **[어빌리티 기반 클래스와 활성화 흐름](./1.3_Skill-Implementation.md)**: 이 문서에서 언급된 `UBaseGameplayAbility`의 내부 동작에 대한 더 상세한 설명입니다.
*   **[Input 및 HUD와 ASC 연동](./1.5_Input_HUD_ASC.md)**: 스킬을 사용하는 입력 및 UI 피드백 과정과 직접적으로 연관됩니다.
